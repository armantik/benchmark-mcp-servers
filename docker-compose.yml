services:
  java-server:
    build: ./java-server
    container_name: mcp-java-server
    ports:
      - "8080:8080"
    environment:
      - SERVER_TYPE=java
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1G
    healthcheck:
      test: [ "CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/actuator/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mcp-network

  go-server:
    build: ./go-server
    container_name: mcp-go-server
    ports:
      - "8081:8081"
    environment:
      - SERVER_TYPE=go
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1G
    healthcheck:
      test: [ "CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8081/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - mcp-network

  python-server:
    build: ./python-server
    container_name: mcp-python-server
    ports:
      - "8082:8082"
    environment:
      - SERVER_TYPE=python
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1G
    healthcheck:
      test: [ "CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8082/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - mcp-network

  nodejs-server:
    build: ./nodejs-server
    container_name: mcp-nodejs-server
    ports:
      - "8083:8083"
    environment:
      - SERVER_TYPE=nodejs
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1G
    healthcheck:
      test: [ "CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8083/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - mcp-network

  rust-server:
    build: ./rust-server
    container_name: mcp-rust-server
    ports:
      - "8084:8084"
    environment:
      - SERVER_TYPE=rust
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1G
    healthcheck:
      test: [ "CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8084/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - mcp-network

  # Mock API para testes de I/O
  mock-api:
    platform: linux/amd64
    image: mockserver/mockserver:latest
    container_name: mcp-mock-api
    ports:
      - "1080:1080"
    environment:
      - MOCKSERVER_INITIALIZATION_JSON_PATH=/config/mockserver.json
    volumes:
      - ./mock-api/mockserver.json:/config/mockserver.json:ro
    networks:
      - mcp-network

networks:
  mcp-network:
    driver: bridge
